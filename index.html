<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Element | ××•×× ×•×™×•×ª ×œ×—×™××” ×•×ª× ×•×¢×”</title>
  <meta name="description" content="×”×–××™× ×• ×©×™×¢×•×¨ ×”×™×›×¨×•×ª ××• ××™××•×Ÿ ××™×©×™ ×‘××œ×× ×˜ - ×¡×˜×•×“×™×• ×œ×©×™×œ×•×‘ ××•×× ×•×™×•×ª ×œ×—×™××”, ×›×•×©×¨ ×•×ª× ×•×¢×” - ×”××§×¤×¦×” ×©×œ×›× ×œ×”×ª×¤×ª×—×•×ª ×“×¨×š ×ª×¨×’×•×œ">
  <meta property="og:title" content="Element | ××•×× ×•×™×•×ª ×œ×—×™××” ×•×ª× ×•×¢×”">
  <meta property="og:description" content="×”×–××™× ×• ×©×™×¢×•×¨ ×”×™×›×¨×•×ª ××• ××™××•×Ÿ ××™×©×™ ×‘××œ×× ×˜ - ×¡×˜×•×“×™×• ×œ×©×™×œ×•×‘ ××•×× ×•×™×•×ª ×œ×—×™××”, ×›×•×©×¨ ×•×ª× ×•×¢×” - ×”××§×¤×¦×” ×©×œ×›× ×œ×”×ª×¤×ª×—×•×ª ×“×¨×š ×ª×¨×’×•×œ">
  <meta property="og:image" content="https://element-m-a-m.github.io/book-first-classes/Element%20Color%20Logo%20White%20Text%20Dark%20Background%20-%202500px.png">
  <meta property="og:type" content="website">
  <link id="dynamic-favicon" rel="icon" type="image/png" href="https://element-m-a-m.github.io/book-first-classes/White%20Background%20-%20Black%20Logo%20-%20No%20Text.png">
  <script>
    function updateFavicon(){var f=document.getElementById('dynamic-favicon'),d=window.matchMedia&&window.matchMedia('(prefers-color-scheme:dark)').matches;f.href=d?"https://element-m-a-m.github.io/book-first-classes/No%20Background%20White%20Dragon%20Only%20No%20Text.png":"https://element-m-a-m.github.io/book-first-classes/White%20Background%20-%20Black%20Logo%20-%20No%20Text.png"}
    updateFavicon();if(window.matchMedia)window.matchMedia('(prefers-color-scheme:dark)').addEventListener('change',updateFavicon);
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
  <style>
    body{margin:0;padding:0;font-family:'Heebo',sans-serif;background-color:#f5f4f0}
    .widget-scroll::-webkit-scrollbar{width:5px}
    .widget-scroll::-webkit-scrollbar-track{background:transparent}
    .widget-scroll::-webkit-scrollbar-thumb{background:#E0E0DC;border-radius:10px}
    .widget-scroll::-webkit-scrollbar-thumb:hover{background:#ccc}
    .widget-scroll{scrollbar-width:thin;scrollbar-color:#E0E0DC transparent}
    .premium-input{transition:border 0.2s ease,box-shadow 0.2s ease!important}
    .premium-input:focus-within{border-color:#1a1a2e!important;box-shadow:0 0 0 3px rgba(26,26,46,0.15)!important}
    @keyframes fadeSlideUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
<div id="element-booking-widget-container"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const { useState, useMemo, useEffect, useRef, useCallback } = React;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIGURATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CFG = {
  branches: [
    { id: "martial-arts", title: "××•×× ×•×™×•×ª ×œ×—×™××”", subtitle: "×”×’× ×” ×¢×¦××™×ª, ×‘×™×˜×—×•×Ÿ ×•××©××¢×ª", icon: "martial", color: "#C4342D", colorLight: "#FFF5F4", type: "group" },
    { id: "movement", title: "××•×‘×× ×˜ ×•××™××•×Ÿ ×’×•×¤× ×™", subtitle: "×ª× ×•×¢×”, ×’××™×©×•×ª ×•×›×•×— ×¤×•× ×§×¦×™×•× ×œ×™", icon: "movement", color: "#1A7A6D", colorLight: "#F0FAF8", type: "group" },
    { id: "private", title: "××™××•× ×™× ××™×©×™×™× / ×–×•×’×™×™×", subtitle: "×œ×™×•×•×™ ×¤×¨×˜×™ ××•×ª×× ××™×©×™×ª", icon: "private", color: "#8B6914", colorLight: "#FDF9F0", type: "private" },
  ],
  categories: [
    { id: "kids-6-8", branchId: "martial-arts", label: "×™×œ×“×™× ×’×™×œ××™ 6-8", icon: "kidsYoung", desc: "×‘× ×™×™×ª ×‘×™×˜×—×•×Ÿ, ××©××¢×ª ×¢×¦××™×ª ×•×ª× ×•×¢×” ×“×¨×š ××©×—×§", forChild: true },
    { id: "kids-9-11", branchId: "martial-arts", label: "×™×œ×“×™× ×’×™×œ××™ 9-11", icon: "kidsOlder", desc: "×¤×™×ª×•×— ×˜×›× ×™×§×”, ×›×•×— ×’×•×¤× ×™ ×•×—×•×¡×Ÿ × ×¤×©×™", forChild: true },
    { id: "youth-12-15", branchId: "martial-arts", label: "× ×•×¢×¨ ×¦×¢×™×¨ 12-15", icon: "youth", desc: "××ª×’×¨, ××©××¢×ª, ×‘×™×˜×—×•×Ÿ ×¢×¦××™ ×•×›×•×©×¨ ×’×•×¤× ×™", forChild: true },
    { id: "adults-16-37", branchId: "martial-arts", label: "×‘×•×’×¨×™× ×•× ×•×¢×¨ 16-37", icon: "adults", desc: "×˜×›× ×™×§×”, ×›×•×—, ×”×ª××“×” ×•××™×™× ×“×¡×˜ ×œ×—×™××ª×™" },
    { id: "adults-38-58", branchId: "martial-arts", label: "××‘×•×’×¨×™× ×¦×¢×™×¨×™× 38-58", icon: "adultsPlus", desc: "×©×™×œ×•×‘ ×™×™×—×•×“×™ ×©×œ ×›×•×©×¨, ×‘×¨×™××•×ª ×•××•×× ×•×™×•×ª ×œ×—×™××”", tag: "special" },
    { id: "movement-class", branchId: "movement", label: "××•×‘×× ×˜", icon: "flow", desc: "×’××™×©×•×ª, ×©×œ×™×˜×” ×•×—×•×¤×© ×‘×’×•×£. ×‘×”× ×—×™×™×ª ×œ×™××•×¨ ×•×¨×“×™", tag: "popular" },
    { id: "strength", branchId: "movement", label: "×›×•×— ×•×’××™×©×•×ª", icon: "strength", desc: "×—×™×–×•×§ ×•×©×™×¤×•×¨ ×˜×•×•×—×™ ×ª× ×•×¢×”" },
    { id: "private-martial", branchId: "private", label: "××•×× ×•×™×•×ª ×œ×—×™××” ×•×”×’× ×” ×¢×¦××™×ª", icon: "privateFight", desc: "××™××•×Ÿ ××•×ª×× ××™×©×™×ª" },
    { id: "private-rehab", branchId: "private", label: "×›×•×©×¨, ×¤×™×–×™×•×ª×¨×¤×™×” ×•×©×™×§×•×", icon: "privateRehab", desc: "×¤×™×–×™×•×ª×¨×¤×™×” ×•××™××•×Ÿ ××•×ª××" },
    { id: "private-duo", branchId: "private", label: "××™××•× ×™ ×–×•×’×•×ª, ×™×œ×“×™× ×•××©×¤×—×•×ª", icon: "privateDuo", desc: "×—×•×•×™×” ××©×•×ª×¤×ª ×œ×©× ×™×™× ×•××¢×œ×”" },
  ],
  classes: [
    { categoryId: "kids-6-8", day: "×¨××©×•×Ÿ", time: "17:00", timeEnd: "17:45", mins: 45, dayNum: 0 },
    { categoryId: "kids-6-8", day: "×¨×‘×™×¢×™", time: "17:00", timeEnd: "17:45", mins: 45, dayNum: 3 },
    { categoryId: "kids-9-11", day: "×¨××©×•×Ÿ", time: "17:45", timeEnd: "18:45", mins: 60, dayNum: 0 },
    { categoryId: "kids-9-11", day: "×¨×‘×™×¢×™", time: "17:45", timeEnd: "18:45", mins: 60, dayNum: 3 },
    { categoryId: "youth-12-15", day: "×¨××©×•×Ÿ", time: "18:45", timeEnd: "20:00", mins: 75, dayNum: 0 },
    { categoryId: "youth-12-15", day: "×¨×‘×™×¢×™", time: "18:45", timeEnd: "20:00", mins: 75, dayNum: 3 },
    { categoryId: "adults-16-37", day: "×¨××©×•×Ÿ", time: "18:45", timeEnd: "20:00", mins: 75, dayNum: 0 },
    { categoryId: "adults-16-37", day: "×¨×‘×™×¢×™", time: "18:45", timeEnd: "20:00", mins: 75, dayNum: 3 },
    { categoryId: "adults-38-58", day: "×©× ×™", time: "18:15", timeEnd: "19:30", mins: 75, dayNum: 1 },
    { categoryId: "adults-38-58", day: "×—××™×©×™", time: "18:15", timeEnd: "19:30", mins: 75, dayNum: 4 },
    { categoryId: "movement-class", day: "×©×œ×™×©×™", time: "19:45", timeEnd: "21:00", mins: 75, dayNum: 2 },
    { categoryId: "movement-class", day: "×©×™×©×™", time: "14:30", timeEnd: "15:45", mins: 75, dayNum: 5 },
    { categoryId: "strength", day: "×©×œ×™×©×™", time: "18:30", timeEnd: "19:45", mins: 75, dayNum: 2 },
    { categoryId: "strength", day: "×©×™×©×™", time: "15:45", timeEnd: "17:00", mins: 75, dayNum: 5 },
  ],
  packages: [
    { id: "single", label: "×©×™×¢×•×¨ ×‘×•×“×“", price: 70, entries: 1 },
    { id: "trial3", label: "3 ×©×™×¢×•×¨×™ ×”×™×›×¨×•×ª", price: 99, entries: 3, validity: "4 ×©×‘×•×¢×•×ª", fullPrice: 210 },
  ],
  studio: { name: "×¡× ×™×£ ×—×•×œ×•×Ÿ", address: '×¨×—×•×‘ "×—×–×™×ª ×—××©" 2, ×©×›×•× ×ª ×ª×œ ×’×™×‘×•×¨×™×, ×—×•×œ×•×Ÿ' },
  bookingUrl: "https://app.boostapp.co.il/lessons.php?GetUrl=660cf18a7e302",
  waPhone: "972512826106",
  webhookUrl: "https://script.google.com/macros/s/AKfycbyJ0CjKQq8jM0i_Mg1qgCkwbLeY2Gb9f5iX2kF6CC-4PQz8keR9O7CWNW3os8ch2bt00A/exec",
  whatToBring: ["ğŸ‘• ×‘×’×“×™ ×¡×¤×•×¨×˜ × ×•×—×™× (×‘×©×™×¢×•×¨×™ ×”×œ×—×™××” - ××›× ×¡ ××¨×•×š)", "ğŸ’§ ×‘×§×‘×•×§ ××™×", "â° ×œ×”×’×™×¢ 15 ×“×§×•×ª ×œ×¤× ×™", "ğŸ‘Ÿ × ×¢×œ×™ ×¡×¤×•×¨×˜"],
};

const HDAYS = ["×¨××©×•×Ÿ","×©× ×™","×©×œ×™×©×™","×¨×‘×™×¢×™","×—××™×©×™","×©×™×©×™","×©×‘×ª"];
const HDAYS_S = ["××³","×‘×³","×’×³","×“×³","×”×³","×•×³"];
const HMONTHS = ["×™× ×•××¨","×¤×‘×¨×•××¨","××¨×¥","××¤×¨×™×œ","×××™","×™×•× ×™","×™×•×œ×™","××•×’×•×¡×˜","×¡×¤×˜××‘×¨","××•×§×˜×•×‘×¨","× ×•×‘××‘×¨","×“×¦××‘×¨"];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITY FUNCTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function makeWeeks(start, n, active) {
  const out = [];
  const c = new Date(start);
  if (c.getDay() !== 0) c.setDate(c.getDate() - c.getDay());
  c.setHours(0, 0, 0, 0);
  const now = new Date(); now.setHours(0, 0, 0, 0);
  for (let w = 0; w < n; w++) {
    const wk = [];
    for (let d = 0; d < 6; d++) {
      const dt = new Date(c); dt.setDate(c.getDate() + d);
      wk.push({ date: dt, dayNum: dt.getDay(), day: dt.getDate(), month: dt.getMonth(), year: dt.getFullYear(), isActive: active.includes(dt.getDay()) && dt > now });
    }
    out.push(wk);
    c.setDate(c.getDate() + 7);
  }
  return out;
}

function fmt(d) { return String(d.getDate()).padStart(2,"0") + "." + String(d.getMonth()+1).padStart(2,"0") + "." + d.getFullYear(); }
function waLink(phone, text) { return "https://wa.me/" + phone + "?text=" + encodeURIComponent(text); }

/* â”€â”€ Backend webhook â”€â”€ */
function sendEvent(eventName, data) {
  if (!CFG.webhookUrl) return;
  const payload = { event: eventName, ...data, device: /Mobi/i.test(navigator.userAgent) ? "mobile" : "desktop", utm: new URLSearchParams(window.location.search).get("utm_source") || "" };
  fetch(CFG.webhookUrl, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) }).catch(function(e) { console.warn("Webhook error:", e); });
}

function getCleanPhone(p) {
  let c = p.replace(/\D/g, '');
  if (c.startsWith('972')) return '+' + c;
  if (c.startsWith('0')) return '+972' + c.substring(1);
  return c ? '+972' + c : '';
}

function countDigits(p) { return p.replace(/\D/g, '').length; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED COMPONENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function Ico({ name, color, size }) {
  const s = size || 20;
  const c = color || "#666";
  const map = {
    martial: <svg width={s} height={s} viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="22" fill={c+"12"} stroke={c} strokeWidth="1.5"/><path d="M19 32L24 16L29 32" stroke={c} strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/><path d="M21 27H27" stroke={c} strokeWidth="2" strokeLinecap="round"/><circle cx="24" cy="14" r="1.5" fill={c}/></svg>,
    movement: <svg width={s} height={s} viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="22" fill={c+"12"} stroke={c} strokeWidth="1.5"/><circle cx="24" cy="33" r="3" fill={c} opacity=".9"/><path d="M24 30V22" stroke={c} strokeWidth="2.3" strokeLinecap="round"/><path d="M19 18L24 22L29 18" stroke={c} strokeWidth="2.3" strokeLinecap="round" strokeLinejoin="round"/></svg>,
    private: <svg width={s} height={s} viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="22" fill={c+"10"} stroke={c} strokeWidth="1.5"/><circle cx="24" cy="14" r="3.5" stroke={c} strokeWidth="2"/><path d="M18 35V24C18 20.7 20.7 18 24 18C27.3 18 30 20.7 30 24V35" stroke={c} strokeWidth="2" strokeLinecap="round"/><circle cx="24" cy="24" r="1.5" fill={c}/></svg>,
    kidsYoung: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="12" cy="5.5" r="3" stroke={c} strokeWidth="1.7"/><path d="M8 22V14C8 11.8 9.8 10 12 10C14.2 10 16 11.8 16 14V22" stroke={c} strokeWidth="1.7" strokeLinecap="round"/></svg>,
    kidsOlder: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="12" cy="5" r="2.8" stroke={c} strokeWidth="1.7"/><path d="M8.5 22V13C8.5 10.8 10 9.5 12 9.5C14 9.5 15.5 10.8 15.5 13V22" stroke={c} strokeWidth="1.7" strokeLinecap="round"/></svg>,
    youth: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="12" cy="4.5" r="2.8" stroke={c} strokeWidth="1.7"/><path d="M8 22V12C8 10 9.8 8.5 12 8.5C14.2 8.5 16 10 16 12V22" stroke={c} strokeWidth="1.7" strokeLinecap="round"/></svg>,
    adults: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="12" cy="4.5" r="2.8" stroke={c} strokeWidth="1.7"/><path d="M8.5 22V12.5C8.5 10.5 10 9 12 9C14 9 15.5 10.5 15.5 12.5V22" stroke={c} strokeWidth="1.7" strokeLinecap="round"/></svg>,
    adultsPlus: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="11" cy="4.5" r="2.8" stroke={c} strokeWidth="1.7"/><path d="M8 22V13C8 11 9.5 9.5 11 9.5C12.5 9.5 14 11 14 13V22" stroke={c} strokeWidth="1.7" strokeLinecap="round"/><path d="M20 6.5V10.5M18 8.5H22" stroke={c} strokeWidth="1.8" strokeLinecap="round"/></svg>,
    flow: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="17" cy="5.5" r="2.5" stroke={c} strokeWidth="1.7"/><path d="M13 18C13 18 12.5 14 13.5 11C14.5 8 16 7.5 17 9" stroke={c} strokeWidth="1.8" strokeLinecap="round"/></svg>,
    strength: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><path d="M5.5 12H8.5L9.5 10M18.5 12H15.5L14.5 10" stroke={c} strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/><path d="M4.5 11V13M19.5 11V13" stroke={c} strokeWidth="2.2" strokeLinecap="round"/></svg>,
    privateFight: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="12" cy="4" r="2.5" stroke={c} strokeWidth="1.7"/><path d="M9 22V13C9 11 10.3 9.5 12 9.5C13.7 9.5 15 11 15 13V22" stroke={c} strokeWidth="1.7" strokeLinecap="round"/></svg>,
    privateRehab: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="5" stroke={c} strokeWidth="1.7"/><path d="M12 9.5V14.5M9.5 12H14.5" stroke={c} strokeWidth="1.8" strokeLinecap="round"/></svg>,
    privateDuo: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="8.5" cy="5.5" r="2.3" stroke={c} strokeWidth="1.5"/><circle cx="15.5" cy="5.5" r="2.3" stroke={c} strokeWidth="1.5"/></svg>,
    check: <svg width={s} height={s} viewBox="0 0 20 20" fill="none"><path d="M5 10L8.5 13.5L15 7" stroke={c} strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/></svg>,
    clock: <svg width={s} height={s} viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="6" stroke={c} strokeWidth="1.4"/><path d="M8 5V8L10.5 10" stroke={c} strokeWidth="1.4" strokeLinecap="round"/></svg>,
    star: <svg width={s} height={s} viewBox="0 0 16 16" fill={c}><path d="M8 1L10.12 5.3L15 6.02L11.5 9.42L12.24 14.28L8 12.08L3.76 14.28L4.5 9.42L1 6.02L5.88 5.3L8 1Z"/></svg>,
    pin: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 5.03 7.03 1 12 1C16.97 1 21 5.03 21 10Z" stroke={c} strokeWidth="1.8"/><circle cx="12" cy="10" r="3" stroke={c} strokeWidth="1.8"/></svg>,
    phone: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z" stroke={c} strokeWidth="1.8" strokeLinecap="round" strokeLinejoin="round"/></svg>,
    medical: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke={c} strokeWidth="1.8"/><path d="M12 8V16M8 12H16" stroke={c} strokeWidth="2" strokeLinecap="round"/></svg>,
    cart: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><path d="M1 1H5L7.68 14.39A2 2 0 009.66 16H18.34A2 2 0 0020.32 14.39L22 5H6" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/><circle cx="10" cy="20" r="1.5" fill={c}/><circle cx="18" cy="20" r="1.5" fill={c}/></svg>,
    lock: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><rect x="5" y="11" width="14" height="10" rx="2" stroke={c} strokeWidth="2"/><path d="M8 11V7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7V11" stroke={c} strokeWidth="2" strokeLinecap="round"/><circle cx="12" cy="16" r="1" fill={c}/></svg>,
    calendar: <svg width={s} height={s} viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="15" rx="2" stroke={c} strokeWidth="2"/><path d="M3 11H21M8 3V7M16 3V7" stroke={c} strokeWidth="2" strokeLinecap="round"/><rect x="7" y="15" width="4" height="2" rx="0.5" fill={c}/></svg>,
    wa: <svg width={s} height={s} viewBox="0 0 24 24" fill={c}><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>,
    restart: <svg width={s} height={s} viewBox="0 0 16 16" fill="none"><path d="M2.5 8C2.5 4.96 4.96 2.5 8 2.5C11.04 2.5 13.5 4.96 13.5 8C13.5 11.04 11.04 13.5 8 13.5C6.14 13.5 4.5 12.58 3.5 11.15" stroke={c} strokeWidth="1.5" strokeLinecap="round"/><path d="M2 5.5L2.5 8L5 7" stroke={c} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/></svg>,
    chevR: <svg width={s} height={s} viewBox="0 0 16 16" fill="none"><path d="M6 4L10 8L6 12" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>,
    arrowL: <svg width={s} height={s} viewBox="0 0 16 16" fill="none"><path d="M11 3L6 8L11 13" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>,
    arrowR: <svg width={s} height={s} viewBox="0 0 16 16" fill="none"><path d="M5 3L10 8L5 13" stroke={c} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>,
  };
  return map[name] || null;
}

function Tag({ type }) {
  if (type === "popular") return <span style={{ fontSize: 8, background: "#FFF3E0", color: "#E65100", padding: "1px 5px", borderRadius: 3, fontWeight: 700, display: "inline-flex", alignItems: "center", gap: 2 }}><Ico name="star" color="#F5A623" size={8}/> ×¤×•×¤×•×œ×¨×™</span>;
  if (type === "special") return <span style={{ fontSize: 8, background: "#FFF0F0", color: "#C4342D", padding: "1px 5px", borderRadius: 3, fontWeight: 700, display: "inline-flex", alignItems: "center", gap: 2 }}><Ico name="star" color="#C4342D" size={8}/> ×™×™×—×•×“×™</span>;
  return null;
}

function Btn({ onClick, disabled, color, children, style: sx }) {
  return <button onClick={onClick} disabled={disabled} style={{
    padding: "12px 16px", borderRadius: 11, border: "none", width: "100%",
    background: disabled ? "#ccc" : ("linear-gradient(135deg," + color + "," + color + "DD)"),
    color: "#fff", fontSize: 14, fontWeight: 700, cursor: disabled ? "default" : "pointer",
    fontFamily: "inherit", boxShadow: disabled ? "none" : ("0 4px 14px " + color + "25"),
    opacity: disabled ? 0.6 : 1, transition: "all 0.2s", ...sx,
  }}>{children}</button>;
}

function BackBtn({ onClick }) {
  return <button onClick={onClick} style={{ display: "inline-flex", alignItems: "center", gap: 4, background: "none", border: "none", color: "#888", fontSize: 11.5, cursor: "pointer", marginBottom: 12, padding: 8, margin: "-8px", fontFamily: "inherit" }}><Ico name="chevR" color="#aaa" size={12}/> ×—×–×¨×”</button>;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN WIDGET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function ElementBookingWidget() {
  /* â”€â”€ State â”€â”€ */
  const [step, setStep] = useState("qual");
  const [aud, setAud] = useState(null);
  const [branch, setBranch] = useState(null);
  const [cat, setCat] = useState(null);
  const [pkg, setPkg] = useState(null);
  const [selDates, setSelDates] = useState([]);
  const [dateMode, setDateMode] = useState("pick");
  const [calOff, setCalOff] = useState(0);
  const [medHas, setMedHas] = useState(null);
  const [medText, setMedText] = useState("");
  const [leadName, setLeadName] = useState("");
  const [leadPhone, setLeadPhone] = useState("");
  const [pvMsg, setPvMsg] = useState("");
  const [isPhoneTouched, setIsPhoneTouched] = useState(false);
  const [isNameTouched, setIsNameTouched] = useState(false);
  const [vis, setVis] = useState(true);
  const [animDir, setAnimDir] = useState("f");
  const [showWTB, setShowWTB] = useState(false);
  const [showExit, setShowExit] = useState(false);
  const [hasSeenExit, setHasSeenExit] = useState(false);
  const [showIdle, setShowIdle] = useState(false);
  const [hasSeenIdle, setHasSeenIdle] = useState(false);

  /* â”€â”€ Stable "today" reference (fixes #14 â€” no midnight drift) â”€â”€ */
  const today = useMemo(() => { const d = new Date(); d.setHours(0,0,0,0); return d; }, []);

  /* â”€â”€ Derived values â”€â”€ */
  const isBypass = useMemo(() => { try { return new URLSearchParams(window.location.search).get('admin') === '1'; } catch(e) { return false; } }, []);
  const isP = branch?.type === "private";
  const bc = branch?.color || "#1a1a2e";
  const WARM = "#C4342D";
  const uc = (step === "branch" || step === "cat") ? bc : WARM;
  const maxD = pkg === "single" ? 1 : 3;
  const isChild = aud === "child";
  const isPhoneValid = countDigits(leadPhone) >= 8;
  const isNameValid = leadName.trim().length >= 2;

  const getPkgPrice = (pId) => {
    if (pId === "trial3") return 99;
    if (pId === "single") return (cat?.id === "kids-6-8" || cat?.id === "kids-9-11") ? 60 : 70;
    return 0;
  };
  const pkgObj = CFG.packages.find(p => p.id === pkg);
  const currentPrice = getPkgPrice(pkg);

  function stepIdx() {
    if (step === "qual" || step === "branch") return 0;
    if (step === "cat") return 1;
    if (step === "pform" || step === "pdone") return 2;
    if (step === "details") return 2;
    if (step === "dates") return 3;
    if (step === "medical") return 4;
    if (step === "action" || step === "done" || step === "done-wa") return 5;
    return 0;
  }
  const totalSteps = isP ? 3 : 6;
  const si = stepIdx();
  const isDone = step === "done" || step === "done-wa" || step === "pdone";

  /* â”€â”€ Category / class data â”€â”€ */
  const bCats = branch ? CFG.categories.filter(c => c.branchId === branch.id) : [];
  const fCats = bCats.filter(c => { if (!aud) return true; return aud === "child" ? c.forChild : !c.forChild; });
  const cats2 = fCats.length > 0 ? fCats : bCats;
  const cCls = cat ? CFG.classes.filter(c => c.categoryId === cat.id).sort((a,b) => a.dayNum - b.dayNum) : [];
  const actDays = useMemo(() => cat ? [...new Set(CFG.classes.filter(c => c.categoryId === cat.id).map(c => c.dayNum))] : [], [cat]);

  /* â”€â”€ Calendar: single-class upsell logic â”€â”€ */
  const calDays = useMemo(() => {
    if (pkg === "single" && selDates.length > 0) return [selDates[0].getDay()];
    return actDays;
  }, [pkg, selDates, actDays]);

  const upsellDays = useMemo(() => {
    if (pkg === "single" && selDates.length > 0) return actDays.filter(d => d !== selDates[0].getDay());
    return [];
  }, [pkg, selDates, actDays]);

  function clsFor(dn) { return CFG.classes.find(c => c.categoryId === (cat ? cat.id : "") && c.dayNum === dn); }
  const clsI = selDates.length > 0 ? clsFor(selDates[0].getDay()) : clsFor(actDays[0] !== undefined ? actDays[0] : 0);

  const calStart = useMemo(() => { const d = new Date(); d.setDate(d.getDate() + calOff * 7); return d; }, [calOff]);
  const weeks = useMemo(() => makeWeeks(calStart, 4, calDays), [calStart, calDays]);
  const visMo = useMemo(() => {
    const ms = new Set();
    weeks.forEach(w => w.forEach(d => {
      if (d.isActive || (upsellDays.includes(d.dayNum) && d.date > today)) ms.add(d.month);
    }));
    return [...ms];
  }, [weeks, upsellDays, today]);

  function togDate(d) {
    const k = d.toISOString();
    setSelDates(p => {
      if (p.find(x => x.toISOString() === k)) return p.filter(x => x.toISOString() !== k);
      if (p.length >= maxD) return p;
      return [...p, d];
    });
  }
  function isSel(d) { return selDates.some(x => x.toISOString() === d.toISOString()); }

  /* â”€â”€ Navigation â”€â”€ */
  function go(dir, next, fn) {
    setAnimDir(dir); setVis(false);
    setTimeout(() => { if (fn) fn(); setStep(next); setVis(true); }, 200);
  }
  function fw(s, fn) { go("f", s, fn); }
  function bk(s, fn) { go("b", s, fn); }
  function reset() {
    bk("qual", () => {
      setAud(null); setBranch(null); setCat(null); setPkg(null);
      setSelDates([]); setDateMode("pick"); setCalOff(0); setMedHas(null); setMedText("");
      setPvMsg(""); setShowWTB(false);
    });
  }

  /* â”€â”€ WhatsApp messages â”€â”€ */
  const medLine = medHas ? ("\nâš ï¸ ××’×‘×œ×•×ª ×¨×¤×•××™×•×ª: " + (medText || "×œ× ×¤×•×¨×˜")) : "";
  const childLine = isChild ? "\nğŸ‘¶ ×¨×™×©×•× ×¢×‘×•×¨ ×™×œ×“/×”" : "";
  const cleanPhone = getCleanPhone(leadPhone);

  function groupWA() {
    const sorted = [...selDates].sort((a,b) => a - b);
    const ds = sorted.map((d,i) => (i+1) + ". ×™×•× " + HDAYS[d.getDay()] + ", " + fmt(d) + " â€“ " + (clsFor(d.getDay())?.time || "")).join("\n");
    const datesStr = ds ? "\n××•×¢×“×™×:\n" + ds : "\n××•×¢×“×™×: ×™×ª×•×××• ×˜×œ×¤×•× ×™×ª ×‘×”××©×š";
    const pl = pkg === "single" ? "×©×™×¢×•×¨ ×‘×•×“×“" : "3 ×©×™×¢×•×¨×™ ×”×™×›×¨×•×ª";
    return "ğŸ¯ ×‘×§×©×ª ×—×–×¨×” - " + pl + " ×‘××œ×× ×˜\n\n×©×: " + leadName.trim() + "\n×˜×œ×¤×•×Ÿ: " + cleanPhone + "\n×§×‘×•×¦×”: " + (cat?.label || "") + childLine + medLine + "\n" + datesStr;
  }
  function privWA() {
    return "ğŸ‘‹ ×¤× ×™×™×” ×œ××™××•×Ÿ ××™×©×™ / ×–×•×’×™ - ××œ×× ×˜\n\n×©×: " + leadName.trim() + "\n×˜×œ×¤×•×Ÿ: " + cleanPhone + "\n×ª×—×•×: " + (cat?.label || "") + (pvMsg ? "\n\n×”×¢×¨×•×ª: " + pvMsg : "");
  }

  /* â”€â”€ Payment URLs â”€â”€ */
  let finalUrl = CFG.bookingUrl;
  if (pkg === "trial3") finalUrl = "https://letts.co.il/payment/WXZycXZLa09XMlp3QzhJS2hhNHFkdz09";
  else if (pkg === "single") {
    finalUrl = (cat?.id === "kids-6-8" || cat?.id === "kids-9-11") ? "https://1pa.co/TvavILvPZj" : "https://1pa.co/6nz790XZmG";
  }

  /* â”€â”€ ICS Calendar Export (with timezone fix #4) â”€â”€ */
  const handleAddCalendar = () => {
    if (selDates.length === 0) return;
    try {
      let ics = "BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Element Studio//Booking//HE\n";
      selDates.forEach(d => {
        const cl = clsFor(d.getDay());
        if (!cl?.time) return;
        const toICS = (date, t) => {
          const [h,m] = t.split(':');
          return date.getFullYear() + String(date.getMonth()+1).padStart(2,'0') + String(date.getDate()).padStart(2,'0') + "T" + String(parseInt(h)).padStart(2,'0') + String(parseInt(m)).padStart(2,'0') + "00";
        };
        ics += `BEGIN:VEVENT\nSUMMARY:×©×™×¢×•×¨ × ×™×¡×™×•×Ÿ - ${cat?.label || ""}\nDTSTART;TZID=Asia/Jerusalem:${toICS(d,cl.time)}\nDTEND;TZID=Asia/Jerusalem:${toICS(d,cl.timeEnd)}\nLOCATION:${CFG.studio.address}\nDESCRIPTION:×©×™×¢×•×¨ ×‘××œ×× ×˜ - ××•×× ×•×™×•×ª ×œ×—×™××” ×•×ª× ×•×¢×”\nEND:VEVENT\n`;
      });
      ics += "END:VCALENDAR";
      const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'element-classes.ics';
      document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
    } catch(e) { console.warn("Calendar download blocked."); }
  };

  /* â”€â”€ Analytics events â”€â”€ */
  useEffect(() => {
    const map = { qual:'Viewed_Qualifier', branch:'Viewed_Branch_Select', cat:'Viewed_Category_Select', details:'Viewed_Package_Select', dates:'Viewed_Dates_Select', medical:'Viewed_Medical', action:'Viewed_Checkout', done:'Pending_Payment_Gateway', 'done-wa':'Completed_Booking_WA', pform:'Viewed_Private_Form', pdone:'Completed_Private_Lead' };
    if (typeof window !== 'undefined' && window.dataLayer) window.dataLayer.push({ event: map[step], category: cat?.label, package: pkg });
  }, [step, cat, pkg]);

  /* â”€â”€ Exit Intent (desktop only â€” mouseleave) â”€â”€ */
  useEffect(() => {
    const h = (e) => { if (e.clientY <= 0 && si > 0 && !isDone && !hasSeenExit) { setShowExit(true); setHasSeenExit(true); } };
    if (typeof document !== 'undefined') { document.addEventListener('mouseleave', h); return () => document.removeEventListener('mouseleave', h); }
  }, [si, isDone, hasSeenExit]);

  /* â”€â”€ Idle Timeout (#9 â€” 60s inactivity, works on mobile + desktop) â”€â”€ */
  const lastActivity = useRef(Date.now());
  const sentEvents = useRef({});
  const abandonRef = useRef(null);

  /* â”€â”€ Send event (deduplicated) â”€â”€ */
  const fireEvent = (eventName, extra) => {
    const key = eventName + ":" + (cleanPhone || leadPhone);
    if (sentEvents.current[key]) return;
    sentEvents.current[key] = true;
    const base = { name: leadName.trim(), phone: leadPhone, audience: aud || "" };
    sendEvent(eventName, { ...base, ...extra });
  };

  /* â”€â”€ Abandoned checkout detection â”€â”€ */
  useEffect(() => {
    if (step === "action") {
      abandonRef.current = setTimeout(() => {
        fireEvent("abandoned_checkout", { categoryId: cat?.id, categoryLabel: cat?.label, branchTitle: branch?.label, packageLabel: pkg === "single" ? "×©×™×¢×•×¨ ×‘×•×“×“" : "3 ×©×™×¢×•×¨×™ ×”×™×›×¨×•×ª", price: currentPrice });
      }, 90000);
    } else {
      if (abandonRef.current) clearTimeout(abandonRef.current);
    }
    return () => { if (abandonRef.current) clearTimeout(abandonRef.current); };
  }, [step]);
  useEffect(() => {
    const touch = () => { lastActivity.current = Date.now(); };
    const events = ['click', 'touchstart', 'scroll', 'keydown', 'mousemove'];
    events.forEach(e => window.addEventListener(e, touch, { passive: true }));
    const interval = setInterval(() => {
      if (Date.now() - lastActivity.current > 60000 && si > 0 && !isDone && !hasSeenIdle && !showExit) {
        setShowIdle(true); setHasSeenIdle(true);
      }
    }, 10000);
    return () => { events.forEach(e => window.removeEventListener(e, touch)); clearInterval(interval); };
  }, [si, isDone, hasSeenIdle, showExit]);

  const idleWaMsg = "×”×™×™, ×”×ª×—×œ×ª×™ ×”×¨×©××” ×œ×©×™×¢×•×¨×™ ×”×™×›×¨×•×ª ×‘××¤×œ×™×§×¦×™×™×ª ××œ×× ×˜" + (cat ? ` (${cat.label})` : "") + " ×•××©××— ×œ×¢×–×¨×” ğŸ˜Š";

  /* â”€â”€ Titles â”€â”€ */
  const titles = {
    qual: ["×”×–×× ×ª ×©×™×¢×•×¨ ×”×™×›×¨×•×ª", "××œ×× ×˜ - ××•×× ×•×™×•×ª ×œ×—×™××” ×•×ª× ×•×¢×” | Element"],
    branch: ["×”×–×× ×ª ×©×™×¢×•×¨ ×”×™×›×¨×•×ª", "××œ×× ×˜ - ××•×× ×•×™×•×ª ×œ×—×™××” ×•×ª× ×•×¢×” | Element"],
    cat: [branch?.title || "", branch?.subtitle || ""],
    details: [cat?.label || "", "×‘×—×¨×• ×¡× ×™×£ ×•×—×‘×™×œ×ª ×”×™×›×¨×•×ª"],
    dates: ["×‘×—×¨×• ××•×¢×“×™×", pkg === "single" ? "×‘×—×¨×• ×ª××¨×™×š ×œ×©×™×¢×•×¨" : "×¡×× ×• ×¢×“ 3 ×ª××¨×™×›×™×"],
    medical: ["×›××¢×˜ ×¡×™×™×× ×•", "××™×š × ×•×›×œ ×œ×©××•×¨ ×¢×œ×™×š ×”×›×™ ×˜×•×‘?"],
    action: ["×¡×™×›×•× ×•×”×¨×©××”", "×‘×“×§×• ××ª ×”×¤×¨×˜×™× ×•×”×‘×˜×™×—×• ××§×•×"],
    done: ["××•×¢×‘×¨×™× ×œ×ª×©×œ×•×...", ""],
    "done-wa": ["×”×¤× ×™×™×” × ×©×œ×—×”!", ""],
    pform: ["×¤×¨×˜×™× ×œ×™×¦×™×¨×ª ×§×©×¨", "× ×—×–×•×¨ ××œ×™×š ×‘×”×§×“× ×œ×ª×™××•×"],
    pdone: ["×”×¤× ×™×™×” × ×©×œ×—×”!", ""],
  };
  const ht = titles[step] || ["",""];
  const inpStyle = { padding: "10px 14px", borderRadius: 9, border: "1.5px solid #E0E0DC", fontSize: 13.5, fontFamily: "inherit", color: "#1a1a2e", background: "#FAFAF8", outline: "none", boxSizing: "border-box", width: "100%" };
  const headerBg = isDone ? "linear-gradient(to left,#080a09 0%,#0d2b20 50%,#1A7A6D 120%)" : `linear-gradient(to left,#0a0b10 0%,#131624 50%,${uc} 140%)`;

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STEP RENDER FUNCTIONS
     Each screen is its own function for readability.
     They share state via closure (no prop drilling).
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  const renderQual = () => (
    <div>
      <div style={{ textAlign: "center", marginBottom: 24, marginTop: 8 }}>
        <div style={{ fontSize: 18, fontWeight: 800, color: "#1a1a2e", marginBottom: 4 }}>×‘×¨×•×›×™× ×”×‘××™× ×œ××œ×× ×˜</div>
        <div style={{ fontSize: 13, color: "#666" }}>×›×“×™ ×©× ×•×›×œ ×œ×”×ª××™× ×œ×›× ××ª ×”××™××•×Ÿ ×”××“×•×™×§, × ×©××— ×œ×”×›×™×¨:</div>
      </div>
      {/* Step 1: Audience */}
      <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 12 }}>
        <div style={{ width: 26, height: 26, borderRadius: 13, background: aud ? "#E8E7E3" : uc, color: aud ? "#888" : "#fff", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13, fontWeight: 800, transition: "all 0.3s" }}>{aud ? "âœ“" : "1"}</div>
        <div style={{ fontSize: 15, fontWeight: 700, color: "#1a1a2e" }}>×¢×‘×•×¨ ××™ ×”×©×™×¢×•×¨?</div>
      </div>
      <div style={{ display: "flex", gap: 10, justifyContent: "center", marginBottom: 24, paddingRight: 36, flexWrap: "wrap" }}>
        {[["self","×¢×‘×•×¨×™","×‘×•×’×¨×™× ×•××‘×•×’×¨×™×"],["child","×¢×‘×•×¨ ×”×™×œ×“/×” ×©×œ×™","×™×œ×“×™× ×•× ×•×¢×¨"]].map(([k,l,s]) =>
          <button key={k} onClick={() => setAud(k)} style={{ flex: 1, minWidth: 140, padding: "14px 12px", borderRadius: 14, border: "2px solid " + (aud === k ? uc : "#E8E7E3"), background: aud === k ? (uc+"08") : "#fff", boxShadow: aud ? "none" : "0 4px 12px rgba(0,0,0,0.04)", cursor: "pointer", fontFamily: "inherit", textAlign: "center", transition: "all 0.2s" }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#1a1a2e" }}>{l}</div>
            <div style={{ fontSize: 11, color: "#999", marginTop: 3 }}>{s}</div>
          </button>
        )}
      </div>
      {/* Step 2: Contact details */}
      <div style={{ opacity: aud ? 1 : 0.35, pointerEvents: aud ? "auto" : "none", transition: "all 0.3s", transform: aud ? "translateY(0)" : "translateY(5px)" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 12 }}>
          <div style={{ width: 26, height: 26, borderRadius: 13, background: aud ? uc : "#E8E7E3", color: aud ? "#fff" : "#888", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13, fontWeight: 800, transition: "all 0.3s" }}>2</div>
          <div style={{ fontSize: 15, fontWeight: 700, color: "#1a1a2e" }}>×¤×¨×˜×™ ×§×©×¨ ×œ×©××™×¨×ª ××§×•×:</div>
        </div>
        <div style={{ paddingRight: 36 }}>
          <div style={{ marginBottom: 10 }}>
            <input className="premium-input" value={leadName} onChange={e => setLeadName(e.target.value)} onBlur={() => setIsNameTouched(true)} placeholder="×©× ××œ×" style={{ ...inpStyle, border: "1.5px solid " + (isNameTouched && !isNameValid ? "#C4342D" : "#E0E0DC") }} />
            {isNameTouched && !isNameValid && <div style={{ fontSize: 10.5, color: "#C4342D", marginTop: 4, fontWeight: 500, textAlign: "right" }}>* × × ×œ×”×–×™×Ÿ ×©× ××œ×</div>}
          </div>
          <div style={{ marginBottom: 4 }}>
            <div className="premium-input" style={{ display: 'flex', direction: 'ltr', background: '#FAFAF8', border: '1.5px solid ' + (isPhoneTouched && !isPhoneValid ? '#C4342D' : '#E0E0DC'), borderRadius: 9, overflow: 'hidden' }}>
              <div style={{ padding: '9px 12px', background: '#F0F0EC', color: '#666', borderRight: '1px solid ' + (isPhoneTouched && !isPhoneValid ? '#C4342D' : '#E0E0DC'), fontSize: 13.5, fontWeight: 600, display: 'flex', alignItems: 'center' }}>+972</div>
              <input type="tel" value={leadPhone} onChange={e => setLeadPhone(e.target.value)} onBlur={() => setIsPhoneTouched(true)} placeholder="50-1234567" style={{ flex: 1, padding: '9px 12px', border: 'none', background: 'transparent', outline: 'none', fontSize: 13.5, fontFamily: 'inherit' }}/>
            </div>
            {isPhoneTouched && !isPhoneValid && <div style={{ fontSize: 10.5, color: "#C4342D", marginTop: 4, fontWeight: 500, textAlign: "right" }}>* × × ×œ×”×–×™×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ</div>}
          </div>
          <div style={{ fontSize: 10.5, color: "#999", marginBottom: 14, marginTop: 8, display: "flex", alignItems: "center", gap: 4 }}>
            <Ico name="lock" color="#999" size={10}/> ×”×¤×¨×˜×™× ×©××•×¨×™× ×‘××¢×¨×›×ª ×•×œ× ×™×•×¢×‘×¨×• ×œ×¦×“ ×©×œ×™×©×™
          </div>
          {/* FIX #1: Button properly disabled until all 3 conditions met */}
          <Btn onClick={() => { setIsNameTouched(true); setIsPhoneTouched(true); if (isNameValid && isPhoneValid) { fireEvent("lead_started"); fw("branch"); }}} disabled={!aud || !isNameValid || !isPhoneValid} color={uc}>×”××©×™×›×• ×œ×‘×—×™×¨×ª ××™××•×Ÿ â†</Btn>
        </div>
      </div>
    </div>
  );

  const renderBranch = () => (
    <div>
      <BackBtn onClick={() => bk("qual")}/>
      <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(140px,1fr))", gap: 10, marginTop: 8 }}>
        {CFG.branches.filter(b => b.type === "group").map(br => {
          const bc2 = CFG.categories.filter(c => c.branchId === br.id && (aud === "child" ? c.forChild : aud === "self" ? !c.forChild : true));
          return <div key={br.id} onClick={() => fw("cat", () => setBranch(br))} style={{ borderRadius: 14, border: "2px solid #EDEDEA", background: "#fff", padding: "14px 12px 10px", cursor: "pointer", transition: "transform 0.2s,box-shadow 0.2s" }} onMouseEnter={e => { e.currentTarget.style.transform="translateY(-2px)"; e.currentTarget.style.boxShadow="0 6px 16px rgba(0,0,0,0.06)"; }} onMouseLeave={e => { e.currentTarget.style.transform="translateY(0)"; e.currentTarget.style.boxShadow="none"; }}>
            <div style={{ marginBottom: 6 }}><Ico name={br.icon} color={br.color} size={30}/></div>
            <div style={{ fontSize: 13, fontWeight: 800, color: "#1a1a2e", marginBottom: 2 }}>{br.title}</div>
            <div style={{ fontSize: 10, color: "#888", marginBottom: 8 }}>{br.subtitle}</div>
            <div style={{ display: "flex", flexDirection: "column", gap: 2 }}>
              {bc2.map(c => <div key={c.id} style={{ display: "flex", alignItems: "center", gap: 5, padding: "2px 5px", borderRadius: 5, background: "#F8F7F4" }}>
                <Ico name={c.icon} color={br.color} size={12}/>
                <span style={{ fontSize: 9.5, color: "#444", fontWeight: 500, flex: 1 }}>{c.label}</span>
              </div>)}
            </div>
          </div>;
        })}
      </div>
      <div onClick={() => fw("cat", () => setBranch(CFG.branches[2]))} style={{ marginTop: 10, borderRadius: 14, cursor: "pointer", border: "1.5px solid #E8E2CF", background: "linear-gradient(135deg,#FDFBF5,#FAF6EC)", padding: "12px 16px", display: "flex", alignItems: "center", gap: 12, transition: "transform 0.2s,box-shadow 0.2s" }} onMouseEnter={e => { e.currentTarget.style.transform="translateY(-2px)"; e.currentTarget.style.boxShadow="0 6px 16px rgba(139,105,20,0.1)"; }} onMouseLeave={e => { e.currentTarget.style.transform="translateY(0)"; e.currentTarget.style.boxShadow="none"; }}>
        <Ico name="private" color="#8B6914" size={30}/>
        <div style={{ flex: 1 }}>
          <div style={{ fontSize: 13, fontWeight: 800, color: "#5C4A1A", marginBottom: 4 }}>××™××•× ×™× ××™×©×™×™× / ×–×•×’×™×™×</div>
          <div style={{ fontSize: 10, color: "#9A8A5E", marginBottom: 6 }}>×œ×™×•×•×™ ×¤×¨×˜×™ ××•×ª×× ××™×©×™×ª</div>
          <div style={{ display: "flex", flexWrap: "wrap", gap: 4 }}>
            {["×¤×™×–×™×•×ª×¨×¤×™×”","×”×’× ×” ×¢×¦××™×ª","×™×œ×“×™×","×›×•×©×¨ ×’×•×¤× ×™"].map(t => <span key={t} style={{ background: "rgba(139,105,20,0.1)", color: "#8B6914", padding: "2px 6px", borderRadius: 4, fontSize: 9.5, fontWeight: 600 }}>{t}</span>)}
          </div>
        </div>
      </div>
    </div>
  );

  const renderCat = () => (
    <div>
      <BackBtn onClick={() => bk("branch", () => { setBranch(null); setCat(null); })}/>
      <div style={{ fontSize: 13.5, fontWeight: 700, color: "#1a1a2e", marginBottom: 12 }}>{isP ? "×‘×—×¨×• ××ª ×”×©×™×¨×•×ª ×”×¨×¦×•×™:" : "×‘×—×¨×• ××ª ×”×©×™×¢×•×¨ ×”×¨×¦×•×™:"}</div>
      {cats2.map(c => <div key={c.id} onClick={() => isP ? fw("pform", () => setCat(c)) : fw("details", () => setCat(c))} style={{ display: "flex", alignItems: "center", gap: 10, padding: "11px 12px", borderRadius: 11, border: "1.5px solid #EEEEE9", background: "#fff", cursor: "pointer", marginBottom: 7, transition: "border 0.2s" }} onMouseEnter={e => e.currentTarget.style.border=`1.5px solid ${bc}80`} onMouseLeave={e => e.currentTarget.style.border="1.5px solid #EEEEE9"}>
        <div style={{ width: 36, height: 36, borderRadius: 9, background: bc+"10", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 }}><Ico name={c.icon} color={bc} size={18}/></div>
        <div style={{ flex: 1 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 5 }}>
            <span style={{ fontSize: 13, fontWeight: 700, color: "#1a1a2e" }}>{c.label}</span>
            {c.tag && <Tag type={c.tag}/>}
          </div>
          <div style={{ fontSize: 10.5, color: "#999", marginTop: 1 }}>{c.desc}</div>
        </div>
        <Ico name="arrowL" color={bc} size={15}/>
      </div>)}
    </div>
  );

  const renderDetails = () => (
    <div>
      <BackBtn onClick={() => bk("cat", () => { setCat(null); setPkg(null); })}/>
      <div style={{ background: "#F8F7F4", borderRadius: 12, padding: "16px", marginBottom: 20, marginTop: 8 }}>
        <div style={{ display: "flex", alignItems: "flex-start", gap: 10, marginBottom: 14 }}>
          <div style={{ marginTop: 2 }}><Ico name="pin" color={uc} size={16}/></div>
          <div><div style={{ fontSize: 13, fontWeight: 800, color: "#1a1a2e" }}>{CFG.studio.name}</div><div style={{ fontSize: 11, color: "#777", marginTop: 2 }}>{CFG.studio.address}</div></div>
        </div>
        <div style={{ height: 1, background: "#EAE9E4", margin: "0 0 14px 0" }}/>
        <div style={{ display: "flex", alignItems: "flex-start", gap: 10 }}>
          <div style={{ marginTop: 2 }}><Ico name="clock" color={uc} size={16}/></div>
          <div style={{ flex: 1 }}>
            <div style={{ fontSize: 13, fontWeight: 800, color: "#1a1a2e", marginBottom: 6 }}>×–×× ×™ ×”×§×‘×•×¦×”:</div>
            <div style={{ display: "flex", flexDirection: "column", gap: 6 }}>
              {cCls.map(cl => <div key={cl.dayNum} style={{ fontSize: 12, color: "#555", display: "flex", alignItems: "center", gap: 6, flexWrap: "wrap" }}>
                <span style={{ fontWeight: 700, color: "#1a1a2e", minWidth: 45 }}>×™×•× {cl.day}</span><span>{cl.time} - {cl.timeEnd}</span><span style={{ color: "#aaa", fontSize: 10.5 }}>({cl.mins} ×“×§×³)</span>
              </div>)}
            </div>
          </div>
        </div>
      </div>
      <div style={{ fontSize: 14, fontWeight: 800, color: "#1a1a2e", marginBottom: 10 }}>×‘×—×¨×• ×—×‘×™×œ×ª ×”×™×›×¨×•×ª:</div>
      <div style={{ display: "flex", gap: 8, marginBottom: 16, flexWrap: "wrap" }}>
        <button onClick={() => setPkg("trial3")} style={{ flex: 1, minWidth: 130, padding: "14px 10px", borderRadius: 12, border: "2px solid " + (pkg === "trial3" ? uc : "#E8E7E3"), background: pkg === "trial3" ? (uc+"08") : "#fff", cursor: "pointer", fontFamily: "inherit", textAlign: "center", position: "relative", overflow: "hidden", transition: "all 0.2s" }}>
          <div style={{ position: "absolute", top: 0, right: 0, background: "#00C48C", color: "#fff", fontSize: 9, fontWeight: 700, padding: "2px 8px", borderBottomLeftRadius: 8 }}>××•××œ×¥</div>
          <div style={{ fontSize: 13, fontWeight: 800, color: "#1a1a2e", marginTop: 4 }}>3 ×©×™×¢×•×¨×™ ×”×™×›×¨×•×ª</div>
          <div style={{ marginTop: 6, display: "flex", alignItems: "center", justifyContent: "center", gap: 6 }}>
            <span style={{ fontSize: 12, color: "#bbb", textDecoration: "line-through" }}>â‚ª210</span>
            <span style={{ fontSize: 20, fontWeight: 800, color: uc }}>â‚ª99</span>
          </div>
          <div style={{ fontSize: 10, color: "#00A67E", fontWeight: 800, marginTop: 4 }}>×”×˜×‘×” ×œ××¦×˜×¨×¤×™× ×—×“×©×™×</div>
        </button>
        <button onClick={() => setPkg("single")} style={{ flex: 1, minWidth: 100, padding: "14px 10px", borderRadius: 12, border: "2px solid " + (pkg === "single" ? uc : "#E8E7E3"), background: pkg === "single" ? (uc+"08") : "#fff", cursor: "pointer", fontFamily: "inherit", textAlign: "center", display: "flex", flexDirection: "column", justifyContent: "center", transition: "all 0.2s" }}>
          <div style={{ fontSize: 13, fontWeight: 800, color: "#1a1a2e" }}>×©×™×¢×•×¨ ×‘×•×“×“</div>
          <div style={{ marginTop: 6 }}><span style={{ fontSize: 20, fontWeight: 800, color: "#555" }}>â‚ª{getPkgPrice("single")}</span></div>
        </button>
      </div>
      <Btn onClick={() => fw("dates")} disabled={!pkg} color={uc}>×”××©×™×›×• ×œ×‘×—×™×¨×ª ×ª××¨×™×›×™× â†</Btn>
    </div>
  );

  const renderDates = () => (
    <div>
      <BackBtn onClick={() => bk("details", () => setSelDates([]))}/>
      {clsI && <div style={{ fontSize: 12, color: "#666", marginBottom: 10, display: "flex", alignItems: "center", gap: 5, background: uc+"06", padding: "8px 12px", borderRadius: 8, border: "1px solid "+uc+"15", flexWrap: "wrap" }}>
        <span>××©×š ×”×©×™×¢×•×¨:</span><span style={{ fontWeight: 700, color: uc }}>{clsI.mins}×“×§×³</span><Ico name="clock" color={uc} size={11}/><span>×-{clsI.time} ×¢×“ {clsI.timeEnd}</span>
      </div>}
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 8 }}>
        <button onClick={() => setCalOff(Math.max(0,calOff-4))} disabled={calOff===0} style={{ background: "none", border: "none", cursor: calOff===0 ? "default":"pointer", opacity: calOff===0 ? 0.3:1, padding: 4 }}><Ico name="arrowR" color={uc} size={16}/></button>
        <div style={{ fontSize: 13, fontWeight: 700, color: "#1a1a2e" }}>{visMo.map(m => HMONTHS[m]).join(" â€“ ")} {weeks[0]?.[0]?.year}</div>
        <button onClick={() => setCalOff(Math.min(8,calOff+4))} disabled={calOff>=8} style={{ background: "none", border: "none", cursor: calOff>=8 ? "default":"pointer", opacity: calOff>=8 ? 0.3:1, padding: 4 }}><Ico name="arrowL" color={uc} size={16}/></button>
      </div>
      <div style={{ display: "grid", gridTemplateColumns: "repeat(6,1fr)", gap: 3, marginBottom: 4 }}>
        {HDAYS_S.map((d,i) => <div key={i} style={{ textAlign: "center", fontSize: 11, fontWeight: 600, color: calDays.includes(i) ? uc : upsellDays.includes(i) ? "#D4A843" : "#ccc", padding: "2px 0" }}>{d}</div>)}
      </div>
      <div style={{ marginBottom: 12 }}>
        {weeks.map((wk,wi) => {
          const thisM = wk.find(d => d.isActive)?.month;
          const prevM = wi > 0 ? weeks[wi-1][5]?.month : null;
          const sep = wi > 0 && thisM !== undefined && thisM !== prevM;
          return <div key={wi}>
            {sep && <div style={{ textAlign: "center", padding: "6px 0 4px", fontSize: 11, fontWeight: 700, color: uc, borderTop: "1px dashed "+uc+"25", marginTop: 4 }}>{HMONTHS[thisM]}</div>}
            <div style={{ display: "grid", gridTemplateColumns: "repeat(6,1fr)", gap: 3, marginBottom: 3 }}>
              {wk.map((d,di) => {
                const sel = d.isActive && isSel(d.date);
                const mx = selDates.length >= maxD;
                const classTimeObj = clsFor(d.dayNum);

                /* Buffer time: can't book if class starts within 6 hours */
                let tooSoon = false;
                if (classTimeObj && d.isActive && !sel) {
                  const [h,m] = classTimeObj.time.split(':');
                  const cdt = new Date(d.date); cdt.setHours(parseInt(h),parseInt(m),0,0);
                  const hrs = (cdt - new Date()) / 3600000;
                  if (hrs > 0 && hrs < 6 && !isBypass) tooSoon = true;
                }

                /* Generic urgency: "××§×•××•×ª ××•×’×‘×œ×™×" on dates within 5 days (#2 â€” honest urgency) */
                const daysUntil = Math.ceil((d.date - today) / 86400000);
                const isUrgent = d.isActive && daysUntil > 0 && daysUntil <= 5 && !sel && !tooSoon;

                /* Upsell: show other day dimmed for single-class users */
                const isUpsell = !d.isActive && upsellDays.includes(d.dayNum) && d.date > today;

                const dis = !d.isActive || (!sel && mx) || tooSoon;

                return <button key={di} onClick={d.isActive && !dis ? () => togDate(d.date) : undefined} style={{
                  padding: "6px 2px", borderRadius: 9, minHeight: 48,
                  border: sel ? ("2px solid "+uc) : isUpsell ? "1.5px dashed #E0A84030" : tooSoon ? "1.5px solid #EEE" : d.isActive ? ("1.5px solid "+uc+"25") : "1.5px solid #F0F0EC",
                  background: sel ? (uc+"12") : isUpsell ? "#FDF9F0" : tooSoon ? "#F5F5F5" : d.isActive ? "#fff" : "#FAFAF8",
                  cursor: d.isActive && !dis ? "pointer" : "default",
                  opacity: (dis && !sel && !tooSoon) ? 0.25 : isUpsell ? 0.55 : tooSoon ? 0.4 : 1,
                  fontFamily: "inherit", position: "relative", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center",
                  transition: "all 0.1s", transform: (tooSoon || (dis && !sel)) ? "scale(0.96)" : "scale(1)"
                }}>
                  {sel && <div style={{ position: "absolute", top: 2, left: 2, width: 13, height: 13, borderRadius: 4, background: uc, display: "flex", alignItems: "center", justifyContent: "center" }}><Ico name="check" color="#fff" size={9}/></div>}
                  {isUpsell && <div style={{ position: "absolute", top: 1, right: 1, fontSize: 8, color: "#D4A843" }}>ğŸ”’</div>}
                  <div style={{ fontSize: 15, fontWeight: sel ? 800 : (d.isActive && !tooSoon) ? 700 : isUpsell ? 500 : 400, color: sel ? "#1a1a2e" : (d.isActive && !tooSoon) ? "#333" : isUpsell ? "#C0A060" : "#999" }}>{d.day}</div>
                  {tooSoon ? <div style={{ fontSize: 7.5, color: "#888", fontWeight: 700, opacity: 0.6 }}>× ×¡×’×¨</div>
                  : isUrgent ? <div style={{ fontSize: 7, color: "#C4342D", fontWeight: 700 }}>××§×•××•×ª ××•×’×‘×œ×™×</div>
                  : d.isActive && classTimeObj ? <div style={{ fontSize: 8.5, color: sel ? uc : "#999" }}>{classTimeObj.time}</div>
                  : isUpsell && clsFor(d.dayNum) ? <div style={{ fontSize: 7.5, color: "#C0A060" }}>{clsFor(d.dayNum).time}</div>
                  : null}
                </button>;
              })}
            </div>
          </div>;
        })}
      </div>
      {/* Upsell banner for single-class */}
      {upsellDays.length > 0 && <div style={{ marginBottom: 12, padding: "10px 14px", borderRadius: 10, background: "linear-gradient(135deg,#FDF9F0,#FFF6E8)", border: "1.5px solid #E8D9B0", display: "flex", alignItems: "center", gap: 10 }}>
        <div style={{ fontSize: 20 }}>ğŸ’¡</div>
        <div style={{ flex: 1 }}>
          <div style={{ fontSize: 12, fontWeight: 700, color: "#5C4A1A" }}>×¨×•×¦×™× ×’× ×™×•× {HDAYS[upsellDays[0]]}?</div>
          <div style={{ fontSize: 11, color: "#9A8A5E", marginTop: 1 }}>×©×“×¨×’×• ×œ-3 ×©×™×¢×•×¨×™ ×”×™×›×¨×•×ª ×‘-â‚ª99 ×‘×œ×‘×“</div>
        </div>
        <button onClick={() => { setPkg("trial3"); setDateMode("pick"); setSelDates([]); }} style={{ padding: "7px 14px", borderRadius: 8, border: "none", background: "#D4A843", color: "#fff", fontSize: 11, fontWeight: 700, cursor: "pointer", fontFamily: "inherit", whiteSpace: "nowrap" }}>×©×“×¨×’×• â†</button>
      </div>}
      <div style={{ display: "flex", flexDirection: "column", gap: 10, marginTop: 4 }}>
        <Btn onClick={() => fw("medical")} disabled={selDates.length < 1} color={uc}>×”××©×™×›×• â†</Btn>
        <div style={{ display: "flex", flexDirection: "column", gap: 6, alignItems: "center", marginTop: 4 }}>
          <button onClick={() => { setSelDates([]); fw("medical"); }} style={{ background: "none", border: "none", color: "#888", fontSize: 12, textDecoration: "underline", cursor: "pointer", fontFamily: "inherit", padding: "4px" }}>×œ× ××¦××ª×™ ×ª××¨×™×š ××ª××™×, ××“×œ×’ ×•××ª×× ×‘×”××©×š</button>
          <a href={waLink(CFG.waPhone, "×”×™×™, ×× ×™ ××ª×¢× ×™×™×Ÿ/×ª ×‘" + (cat?.label||"") + " ××‘×œ ×¨×¦×™×ª×™ ×œ×©××•×œ ×œ×’×‘×™ ×”×’×¢×” ×‘×™××™× ××—×¨×™× / ×¤×¢× ×‘×©×‘×•×¢.")} target="_blank" rel="noopener noreferrer" style={{ display: "inline-flex", alignItems: "center", gap: 6, fontSize: 11.5, color: "#25D366", textDecoration: "none", fontWeight: 600, cursor: "pointer", padding: "4px" }}>
            <Ico name="wa" color="#25D366" size={14}/> ××ª×œ×‘×˜×™× ×œ×’×‘×™ ×”×™××™×? ×”×ª×™×™×¢×¦×• ××™×ª× ×• ×‘×•×•××˜×¡××¤
          </a>
        </div>
      </div>
    </div>
  );

  const renderMedical = () => (
    <div>
      <BackBtn onClick={() => bk("dates")}/>
      <div style={{ borderRadius: 12, border: "1.5px solid #E8E7E3", background: "#FAFAF8", padding: "16px 18px", marginBottom: 16 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 12 }}>
          <Ico name="medical" color={uc} size={18}/>
          <div style={{ fontSize: 13.5, fontWeight: 700, color: "#1a1a2e" }}>××™×š × ×•×›×œ ×œ×©××•×¨ ×¢×œ×™×š ×”×›×™ ×˜×•×‘ ×‘××™××•×Ÿ?</div>
        </div>
        <p style={{ fontSize: 11.5, color: "#888", marginBottom: 14 }}>× ×©××— ×œ×“×¢×ª ×¢×œ ××’×‘×œ×•×ª ×¨×¤×•××™×•×ª ××• ×¤×¦×™×¢×•×ª ×—×©×•×‘×•×ª ×›×“×™ ×œ×”×ª××™× ×œ×š ××ª ×”×¤×¢×™×œ×•×ª.</p>
        <div style={{ display: "flex", gap: 8, marginBottom: medHas ? 14 : 0 }}>
          {[[false,"×”×›×œ ×ª×§×™×Ÿ","âœ…"],[true,"×™×© ××” ×œ×“×¢×ª","âš ï¸"]].map(([v,l,e]) =>
            <button key={String(v)} onClick={() => setMedHas(v)} style={{ flex: 1, padding: "11px 10px", borderRadius: 10, border: "2px solid " + (medHas === v ? "#1a1a2e" : "#E0E0DC"), background: medHas === v ? "#1a1a2e" : "#fff", color: medHas === v ? "#fff" : "#555", cursor: "pointer", fontFamily: "inherit", fontWeight: 700, transition: "all 0.2s" }}>{l}</button>
          )}
        </div>
        {/* FIX #15a: resize vertical only */}
        {medHas === true && <textarea className="premium-input" value={medText} onChange={e => setMedText(e.target.value)} placeholder="×¤×¨×˜×• ×‘×§×¦×¨×”: ×¤×¦×™×¢×•×ª ×¢×‘×¨, ××’×‘×œ×•×ª..." style={{ ...inpStyle, minHeight: 64, marginTop: 8, resize: "vertical" }}/>}
      </div>
      <Btn onClick={() => { fireEvent("checkout_reached", { categoryId: cat?.id, categoryLabel: cat?.label, branchTitle: branch?.label, packageLabel: pkg === "single" ? "×©×™×¢×•×¨ ×‘×•×“×“" : "3 ×©×™×¢×•×¨×™ ×”×™×›×¨×•×ª", price: currentPrice, dates: selDates.map(d => d.toISOString()), classTime: cat ? (CFG.classes.find(c => c.categoryId === cat.id)?.time || "") : "", medical: medHas ? (medText || "×›×Ÿ, ×œ× ×¤×•×¨×˜") : "×”×›×œ ×ª×§×™×Ÿ" }); fw("action"); }} disabled={medHas === null} color={uc}>×”××©×™×›×• ×œ×¡×™×›×•× â†</Btn>
    </div>
  );

  const renderSummaryCard = () => (
    <div style={{ borderRadius: 14, background: uc+"06", border: "1px solid "+uc+"15", padding: "12px 14px", marginBottom: 16, textAlign: "right" }}>
      <div style={{ fontSize: 12, fontWeight: 800, color: "#1a1a2e", marginBottom: 6 }}>×”×©×™×¢×•×¨×™× ×©×”×–×× ×ª×:</div>
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 }}>
        <div style={{ fontSize: 12, color: "#555" }}>{cat?.label} â€¢ {pkgObj?.label}</div>
        <div style={{ fontSize: 13, fontWeight: 800, color: uc }}>â‚ª{currentPrice}</div>
      </div>
      <div style={{ fontSize: 11, color: "#777", lineHeight: 1.7 }}>
        {selDates.length > 0 ? [...selDates].sort((a,b)=>a-b).map((d,i) => <div key={i}>â— ×™×•× {HDAYS[d.getDay()]}, {fmt(d)} â€“ {clsFor(d.getDay())?.time}</div>) : <div style={{ color: "#aaa" }}>××•×¢×“×™× ×™×ª×•×××• ×˜×œ×¤×•× ×™×ª ×‘×”××©×š</div>}
      </div>
    </div>
  );

  const renderWTBAccordion = () => (
    <div style={{ margin: "18px 0", textAlign: "right" }}>
      <button onClick={() => setShowWTB(!showWTB)} style={{ width: "100%", padding: "12px 14px", borderRadius: 10, border: "1.5px solid #E8E7E3", background: showWTB ? "#F8F7F4":"#fff", cursor: "pointer", fontFamily: "inherit", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
        <span style={{ fontSize: 13, fontWeight: 700, color: "#1a1a2e" }}>ğŸ’ ××” ×œ×”×‘×™× ×œ×©×™×¢×•×¨ ×”×¨××©×•×Ÿ?</span>
        <span style={{ fontSize: 12, color: "#aaa", transform: showWTB ? "rotate(90deg)":"rotate(0)", transition: "transform 0.2s", display: "inline-block" }}>â–¶</span>
      </button>
      {showWTB && <div style={{ padding: "10px 14px", borderRadius: "0 0 10px 10px", background: "#F8F7F4", border: "1px solid #E8E7E3", borderTop: "none", textAlign: "right" }}>
        {CFG.whatToBring.map((t,i) => <div key={i} style={{ padding: "5px 0", fontSize: 12.5, color: "#555", fontWeight: 500 }}>{t}</div>)}
      </div>}
    </div>
  );

  const renderDoneFooter = () => (
    <div>
      <div style={{ height: 1, background: "#EEEEE9", margin: "16px 0" }}/>
      <div style={{ display: "flex", justifyContent: "center", gap: 8, flexWrap: "wrap" }}>
        <a href={waLink(CFG.waPhone, "×”×™×™, ×™×© ×œ×™ ×©××œ×” ×œ×’×‘×™ ×©×™×¢×•×¨×™ ×”×”×™×›×¨×•×ª ×‘××œ×× ×˜ ğŸ˜Š")} target="_blank" rel="noopener noreferrer" style={{ display: "inline-flex", alignItems: "center", gap: 5, padding: "8px 16px", borderRadius: 9, background: "linear-gradient(135deg,#25D366,#128C7E)", color: "#fff", fontSize: 12, fontWeight: 600, textDecoration: "none", fontFamily: "inherit" }}><Ico name="wa" color="#fff" size={13}/> ×™×© ×œ×™ ×©××œ×”</a>
        <button onClick={reset} style={{ display: "inline-flex", alignItems: "center", gap: 4, background: "none", border: "1px solid #DDD", borderRadius: 9, padding: "8px 16px", color: "#666", fontSize: 12, fontWeight: 500, cursor: "pointer", fontFamily: "inherit" }}><Ico name="restart" color="#888" size={13}/> ×”×–×× ×ª ×©×™×¢×•×¨ × ×•×¡×£</button>
      </div>
    </div>
  );

  const renderAction = () => (
    <div>
      <BackBtn onClick={() => bk("medical")}/>
      {/* Checkout summary card */}
      <div style={{ borderRadius: 14, background: uc+"06", border: "2px solid "+uc+"20", padding: "14px 16px", marginBottom: 18 }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 10 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
            <div style={{ width: 34, height: 34, borderRadius: 9, background: uc+"15", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 }}><Ico name={cat?.icon} color={uc} size={18}/></div>
            <div><div style={{ fontSize: 13.5, fontWeight: 700, color: "#1a1a2e" }}>{cat?.label}</div><div style={{ fontSize: 11, color: "#888" }}>{pkgObj?.label}</div></div>
          </div>
          <div style={{ fontSize: 20, fontWeight: 800, color: uc }}>â‚ª{currentPrice}</div>
        </div>
        <div style={{ borderTop: "1px solid "+uc+"15", paddingTop: 10, fontSize: 11, color: "#777", lineHeight: 1.7 }}>
          {selDates.length > 0 ? [...selDates].sort((a,b)=>a-b).map((d,i) => <div key={i}>â— ×™×•× {HDAYS[d.getDay()]}, {fmt(d)} â€“ {clsFor(d.getDay())?.time}</div>) : <div style={{ color: "#aaa" }}>××•×¢×“×™× ×™×ª×•×××• ×˜×œ×¤×•× ×™×ª ×‘×”××©×š</div>}
        </div>
      </div>
      <div style={{ fontSize: 14, fontWeight: 800, color: "#1a1a2e", marginBottom: 12 }}>××™×š ×ª×¨×¦×• ×œ×”××©×™×š?</div>
      {/* Option 1: Self-book */}
      <div style={{ borderRadius: 14, border: "1.5px solid "+uc+"40", background: uc+"08", padding: "16px", marginBottom: 12 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 12 }}>
          <div style={{ width: 26, height: 26, borderRadius: 13, background: uc, color: "#fff", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 14, fontWeight: 800, flexShrink: 0 }}>1</div>
          <div style={{ fontSize: 15, fontWeight: 800, color: "#1a1a2e" }}>×”×¨×©××” ××”×™×¨×” (×ª×©×œ×•× ××•× ×œ×™×™×Ÿ)</div>
        </div>
        <div style={{ display: "flex", alignItems: "center", gap: 5, marginBottom: 14, paddingRight: 36 }}>
          <Ico name="lock" color="#0D7C5F" size={13}/><span style={{ fontSize: 11.5, fontWeight: 700, color: "#0D7C5F" }}>×ª×©×œ×•× ×××•×‘×˜×— ×•××•×¦×¤×Ÿ</span>
        </div>
        <button onClick={() => { fireEvent("booking_selfbook", { categoryId: cat?.id, categoryLabel: cat?.label }); fw("done"); setTimeout(() => window.open(finalUrl,"_blank"), 1200); }} style={{ width: "100%", padding: "14px", borderRadius: 10, border: "none", background: "linear-gradient(135deg,"+uc+","+uc+"DD)", color: "#fff", fontWeight: 700, fontSize: 14, cursor: "pointer", fontFamily: "inherit", boxShadow: "0 4px 14px "+uc+"30", transition: "all 0.2s" }}>××¢×‘×¨ ×œ××¢×¨×›×ª ×”×”×–×× ×” â†</button>
      </div>
      {/* Option 2: Callback */}
      <div style={{ borderRadius: 14, border: "1.5px solid #E8E7E3", background: "#fff", padding: "16px" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 12 }}>
          <div style={{ width: 26, height: 26, borderRadius: 13, background: "#F0F0EC", color: "#666", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 14, fontWeight: 800, flexShrink: 0 }}>2</div>
          <div style={{ fontSize: 14, fontWeight: 700, color: "#1a1a2e" }}>× ×¦×™×’ ×™×—×–×•×¨ ××œ×™×™ (×œ×ª×™××•× ×•×”×¨×©××”)</div>
        </div>
        <div style={{ display: "flex", gap: 8, paddingRight: 36, flexWrap: "wrap" }}>
          <div className="premium-input" style={{ flex: "1 1 150px", display: 'flex', direction: 'ltr', background: '#FAFAF8', border: '1.5px solid #E0E0DC', borderRadius: 9, overflow: 'hidden' }}>
            <div style={{ padding: '9px 8px', background: '#F0F0EC', color: '#666', borderRight: '1px solid #E0E0DC', fontSize: 13, fontWeight: 600, display: 'flex', alignItems: 'center' }}>+972</div>
            <input type="tel" value={leadPhone} onChange={e => setLeadPhone(e.target.value)} placeholder="50-1234567" style={{ flex: 1, width: '100%', padding: '9px 8px', border: 'none', background: 'transparent', outline: 'none', fontSize: 13, fontFamily: 'inherit' }}/>
          </div>
          <button onClick={() => { fireEvent("booking_callback", { categoryId: cat?.id, categoryLabel: cat?.label }); window.open(waLink(CFG.waPhone, groupWA()), "_blank"); fw("done-wa"); }} disabled={!isPhoneValid} style={{ padding: "9px 18px", borderRadius: 9, border: "none", background: isPhoneValid ? "linear-gradient(135deg,#25D366,#128C7E)" : "#ddd", color: "#fff", fontWeight: 700, cursor: isPhoneValid ? "pointer":"default", fontFamily: "inherit", transition: "all 0.2s" }}>×©×œ×—×•</button>
        </div>
      </div>
    </div>
  );

  const renderDone = () => (
    <div>
      <BackBtn onClick={() => bk("action")}/>
      <div style={{ textAlign: "center", padding: "8px 0" }}>
        <div style={{ width: 50, height: 50, borderRadius: "50%", background: "#1a1a2e", display: "flex", alignItems: "center", justifyContent: "center", margin: "4px auto 14px", boxShadow: "0 5px 16px rgba(26,26,46,0.2)" }}><Ico name="lock" color="#fff" size={22}/></div>
        <div style={{ fontSize: 16, fontWeight: 800, color: "#1a1a2e", marginBottom: 6 }}>××¢×‘×™×¨×™× ××•×ª×š ×œ×ª×©×œ×•× ×××•×‘×˜×—...</div>
        <div style={{ fontSize: 12.5, color: "#666", marginBottom: 16, lineHeight: 1.5 }}>×›×“×™ ×œ×”×‘×˜×™×— ××ª ××§×•××š, ×× × ×”×©×œ×/×™ ××ª ×”×ª×©×œ×•× ×‘×¢××•×“ ×©× ×¤×ª×—.<br/><span style={{ fontSize: 11, opacity: 0.8 }}>* ×”×©×™×‘×•×¥ ×™××•×©×¨ ×¡×•×¤×™×ª ×¢"×™ ×”×¦×•×•×ª (×‘××§×¨×” ×©×œ ×©×™× ×•×™×™× × ×¢×“×›×Ÿ).</span></div>
        {renderSummaryCard()}
        <div style={{ display: "flex", gap: 8, justifyContent: "center", marginBottom: 14, flexWrap: "wrap" }}>
          <a href={finalUrl} target="_blank" rel="noopener noreferrer" style={{ display: "flex", alignItems: "center", justifyContent: "center", height: "44px", padding: "0 16px", borderRadius: 10, background: "#1a1a2e", color: "#fff", fontSize: 12.5, fontWeight: 600, textDecoration: "none", fontFamily: "inherit", boxSizing: "border-box" }}>××¢×‘×¨ ×œ×¢××•×“ ×”×ª×©×œ×•×</a>
          {selDates.length > 0 && <div style={{ display: "flex", flexDirection: "column", alignItems: "center" }}>
            <button onClick={handleAddCalendar} style={{ display: "flex", alignItems: "center", justifyContent: "center", height: "44px", gap: 6, padding: "0 16px", borderRadius: 10, background: "#F0FAF8", border: "1.5px solid #1A7A6D", color: "#1A7A6D", fontSize: 12.5, fontWeight: 700, cursor: "pointer", fontFamily: "inherit", boxSizing: "border-box" }}><Ico name="calendar" color="#1A7A6D" size={14}/> ×”×•×¡×¤×” ×œ×™×•××Ÿ</button>
            <div style={{ fontSize: 10, color: "#999", marginTop: 4 }}>* ×‘×× ×“×¨×•××™×“: ×™×© ×œ×¤×ª×•×— ××ª ×”×§×•×‘×¥ ×œ××—×¨ ×”×”×•×¨×“×”</div>
          </div>}
        </div>
        {renderWTBAccordion()}
        {renderDoneFooter()}
      </div>
    </div>
  );

  const renderDoneWa = () => (
    <div>
      <BackBtn onClick={() => bk("action")}/>
      <div style={{ textAlign: "center", padding: "8px 0" }}>
        <div style={{ width: 50, height: 50, borderRadius: "50%", background: "#00E5A0", display: "flex", alignItems: "center", justifyContent: "center", margin: "4px auto 14px", boxShadow: "0 5px 16px rgba(0,229,160,0.3)" }}><Ico name="check" color="#fff" size={22}/></div>
        <div style={{ fontSize: 16, fontWeight: 800, color: "#1a1a2e", marginBottom: 6 }}>×”×¤× ×™×™×” × ×©×œ×—×” ×‘×”×¦×œ×—×”!</div>
        <div style={{ fontSize: 12.5, color: "#666", marginBottom: 16, lineHeight: 1.5 }}>× ×¦×™×’ ×©×œ× ×• ×™×—×–×•×¨ ××œ×™×š ×‘×”×§×“× ×œ×ª×™××•× ×•×”×©×œ××ª ×”×”×¨×©××”.<br/>(×”×©×™×—×” × ×¤×ª×—×” ×‘×—×œ×•×Ÿ ×•×•××˜×¡××¤ ×—×“×©)</div>
        {renderSummaryCard()}
        {selDates.length > 0 && <div style={{ display: "flex", gap: 8, justifyContent: "center", marginBottom: 14 }}>
          <div style={{ display: "flex", flexDirection: "column", alignItems: "center" }}>
            <button onClick={handleAddCalendar} style={{ display: "flex", alignItems: "center", justifyContent: "center", height: "44px", gap: 6, padding: "0 16px", borderRadius: 10, background: "#F0FAF8", border: "1.5px solid #1A7A6D", color: "#1A7A6D", fontSize: 12.5, fontWeight: 700, cursor: "pointer", fontFamily: "inherit", boxSizing: "border-box" }}><Ico name="calendar" color="#1A7A6D" size={14}/> ×©×¨×™×•×Ÿ ×‘×™×•××Ÿ</button>
            <div style={{ fontSize: 10, color: "#999", marginTop: 4 }}>* ×‘×× ×“×¨×•××™×“: ×™×© ×œ×¤×ª×•×— ××ª ×”×§×•×‘×¥ ×œ××—×¨ ×”×”×•×¨×“×”</div>
          </div>
        </div>}
        {renderWTBAccordion()}
        {renderDoneFooter()}
      </div>
    </div>
  );

  /* FIX #20: Private form uses shared leadName (pre-filled) + proper validation */
  const renderPform = () => (
    <div>
      <BackBtn onClick={() => bk("cat", () => setCat(null))}/>
      <div style={{ marginBottom: 11 }}><label style={{ fontSize: 12, fontWeight: 600, display: "block", marginBottom: 4 }}>×©× ××œ×</label><input className="premium-input" value={leadName} onChange={e => setLeadName(e.target.value)} onBlur={() => setIsNameTouched(true)} style={{ ...inpStyle, border: "1.5px solid " + (isNameTouched && !isNameValid ? "#C4342D" : "#E0E0DC") }}/>{isNameTouched && !isNameValid && <div style={{ fontSize: 10.5, color: "#C4342D", marginTop: 4, fontWeight: 500 }}>* × × ×œ×”×–×™×Ÿ ×©× ××œ×</div>}</div>
      <div style={{ marginBottom: 11 }}>
        <label style={{ fontSize: 12, fontWeight: 600, display: "block", marginBottom: 4 }}>×˜×œ×¤×•×Ÿ</label>
        <div className="premium-input" style={{ display: 'flex', direction: 'ltr', background: '#FAFAF8', border: '1.5px solid ' + (isPhoneTouched && !isPhoneValid ? '#C4342D' : '#E0E0DC'), borderRadius: 9, overflow: 'hidden' }}>
          <div style={{ padding: '9px 12px', background: '#F0F0EC', color: '#666', borderRight: '1px solid #E0E0DC', fontSize: 13.5, fontWeight: 600, display: 'flex', alignItems: 'center' }}>+972</div>
          <input type="tel" value={leadPhone} onChange={e => setLeadPhone(e.target.value)} onBlur={() => setIsPhoneTouched(true)} placeholder="50-1234567" style={{ flex: 1, padding: '9px 12px', border: 'none', background: 'transparent', outline: 'none', fontSize: 13.5, fontFamily: 'inherit' }}/>
        </div>
        {isPhoneTouched && !isPhoneValid && <div style={{ fontSize: 10.5, color: "#C4342D", marginTop: 4, fontWeight: 500 }}>* × × ×œ×”×–×™×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×ª×§×™×Ÿ</div>}
      </div>
      <div style={{ marginBottom: 12 }}><label style={{ fontSize: 12, fontWeight: 600, display: "block", marginBottom: 4 }}>×”×¢×¨×•×ª</label><textarea className="premium-input" value={pvMsg} onChange={e => setPvMsg(e.target.value)} placeholder="×¡×¤×¨×• ×œ× ×• ×¢×œ ×”××˜×¨×” ×©×œ×›×, ×•×¦×™×™× ×• ×× ×™×© ××’×‘×œ×•×ª ×¨×¤×•××™×•×ª ×©×—×©×•×‘ ×©× ×“×¢ ×¢×œ×™×”×Ÿ..." style={{ ...inpStyle, minHeight: 64, resize: "vertical" }}/></div>
      <button onClick={() => { setIsNameTouched(true); setIsPhoneTouched(true); if (isNameValid && isPhoneValid) { fireEvent("private_inquiry", { categoryId: cat?.id, categoryLabel: cat?.label, branchTitle: "××™××•×Ÿ ××™×©×™", pvMsg: pvMsg }); window.open(waLink(CFG.waPhone, privWA()), "_blank"); fw("pdone"); }}} disabled={!isNameValid || !isPhoneValid} style={{ width: "100%", padding: "12px", borderRadius: 11, border: "none", background: (isNameValid && isPhoneValid) ? ("linear-gradient(135deg,"+uc+","+uc+"DD)") : "#ccc", color: "#fff", fontWeight: 700, cursor: (isNameValid && isPhoneValid) ? "pointer":"default", fontFamily: "inherit", transition: "all 0.2s", opacity: (isNameValid && isPhoneValid) ? 1 : 0.6 }}>×©×œ×—×• ×¤× ×™×™×” ×‘×•×•××˜×¡××¤</button>
    </div>
  );

  const renderPdone = () => (
    <div>
      <BackBtn onClick={() => bk("pform")}/>
      <div style={{ textAlign: "center", padding: "8px 0" }}>
        <div style={{ width: 50, height: 50, borderRadius: "50%", background: "#00E5A0", display: "flex", alignItems: "center", justifyContent: "center", margin: "4px auto 14px" }}><Ico name="check" color="#fff" size={22}/></div>
        <div style={{ fontSize: 15, fontWeight: 700 }}>×”×¤× ×™×™×” × ×©×œ×—×”</div>
        <div style={{ fontSize: 12.5, color: "#666", marginBottom: 16 }}>× ×—×–×•×¨ ××œ×™×š ×‘×”×§×“× ×œ×ª×™××•× ×”××™××•×Ÿ.</div>
        <div style={{ height: 1, background: "#EEEEE9", margin: "16px 0" }}/>
        <div style={{ display: "flex", justifyContent: "center", gap: 8, flexWrap: "wrap" }}>
          <button onClick={reset} style={{ display: "inline-flex", alignItems: "center", gap: 4, background: "none", border: "1px solid #DDD", borderRadius: 9, padding: "8px 16px", color: "#666", fontSize: 12, fontWeight: 500, cursor: "pointer", fontFamily: "inherit" }}><Ico name="restart" color="#888" size={13}/> ×”×–×× ×ª ×©×™×¢×•×¨ × ×•×¡×£</button>
        </div>
      </div>
    </div>
  );

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN RENDER â€” Step routing + layout
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const stepMap = { qual: renderQual, branch: renderBranch, cat: renderCat, details: renderDetails, dates: renderDates, medical: renderMedical, action: renderAction, done: renderDone, "done-wa": renderDoneWa, pform: renderPform, pdone: renderPdone };

  return (
    /* FIX #15b: Reduced top padding â€” clamp(8px, 2vh, 24px) for mobile fit */
    <div style={{ minHeight: "100vh", padding: "clamp(8px, 2vh, 24px) 16px", boxSizing: "border-box", background: "transparent", display: "flex", alignItems: "flex-start", justifyContent: "center", fontFamily: "'Heebo',sans-serif", position: "relative", paddingTop: "clamp(8px, 2vh, 24px)" }}>

      {/* Exit Intent Modal (desktop) */}
      {showExit && <div style={{ position: "fixed", inset: 0, zIndex: 999, background: "rgba(0,0,0,0.5)", backdropFilter: "blur(4px)", display: "flex", alignItems: "center", justifyContent: "center", padding: 20 }}>
        <div style={{ background: "#fff", borderRadius: 20, width: "100%", maxWidth: 360, padding: 24, textAlign: "center", direction: "rtl", boxShadow: "0 20px 40px rgba(0,0,0,0.2)", animation: "fadeSlideUp 0.3s ease" }}>
          <div style={{ width: 60, height: 60, borderRadius: 30, background: "linear-gradient(135deg,#25D366,#128C7E)", color: "#fff", display: "flex", alignItems: "center", justifyContent: "center", margin: "0 auto 16px" }}><Ico name="wa" color="#fff" size={32}/></div>
          <h3 style={{ margin: "0 0 8px", color: "#1a1a2e", fontSize: 20, fontWeight: 800 }}>××ª×œ×‘×˜×™×?</h3>
          <p style={{ margin: "0 0 24px", color: "#666", fontSize: 14, lineHeight: 1.5 }}>×™×© ×œ×›× ×©××œ×” ×œ×¤× ×™ ×©××–××™× ×™×? ×“×‘×¨×• ×™×©×™×¨×•×ª ×¢× ×œ×™××•×¨ ×”××××Ÿ ×‘×•×•××˜×¡××¤ ×•× ×¢×–×•×¨ ×œ×›× ×œ××¦×•× ××ª ×”××¡×’×¨×ª ×”××ª××™××” ×‘×™×•×ª×¨.</p>
          <a href={waLink(CFG.waPhone, "×”×™×™ ×œ×™××•×¨, ×”×’×¢×ª×™ ××”××ª×¨ ×•×™×© ×œ×™ ×©××œ×” ×œ×’×‘×™ ×”××™××•× ×™× ×‘××œ×× ×˜...")} target="_blank" rel="noopener noreferrer" onClick={() => setShowExit(false)} style={{ display: "block", background: "linear-gradient(135deg,#25D366,#128C7E)", color: "#fff", textDecoration: "none", padding: "14px", borderRadius: 12, fontWeight: 700, fontSize: 15, marginBottom: 12 }}>×©×™×—×” ×‘×•×•××˜×¡××¤</a>
          <button onClick={() => setShowExit(false)} style={{ background: "none", border: "none", color: "#999", fontSize: 13, cursor: "pointer", fontFamily: "inherit", textDecoration: "underline" }}>×œ× ×ª×•×“×”, ××—×–×•×¨ ×œ×”×–×× ×”</button>
        </div>
      </div>}

      {/* Idle Timeout Modal (#9 â€” mobile + desktop, 60s inactivity) */}
      {showIdle && <div style={{ position: "fixed", bottom: 0, left: 0, right: 0, zIndex: 998, padding: "0 16px 16px", display: "flex", justifyContent: "center" }}>
        <div style={{ direction: "rtl", background: "#fff", borderRadius: 16, width: "100%", maxWidth: 440, padding: "20px 20px 16px", boxShadow: "0 -4px 24px rgba(0,0,0,0.12)", border: "1px solid #E8E7E3", animation: "fadeSlideUp 0.3s ease" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 12 }}>
            <div style={{ width: 40, height: 40, borderRadius: 20, background: "linear-gradient(135deg,#25D366,#128C7E)", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 }}><Ico name="wa" color="#fff" size={20}/></div>
            <div>
              <div style={{ fontSize: 15, fontWeight: 800, color: "#1a1a2e" }}>×¦×¨×™×›×™× ×¢×–×¨×”? ğŸ˜Š</div>
              <div style={{ fontSize: 12, color: "#666", marginTop: 2 }}>×× ×—× ×• ×›××Ÿ ×‘×©×‘×™×œ×›× â€“ ×©×œ×—×• ×”×•×“×¢×” ×•× ×¢×–×•×¨ ×œ×¡×™×™× ××ª ×”×”×¨×©××”</div>
            </div>
          </div>
          <div style={{ display: "flex", gap: 8 }}>
            <a href={waLink(CFG.waPhone, idleWaMsg)} target="_blank" rel="noopener noreferrer" onClick={() => setShowIdle(false)} style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", gap: 6, padding: "10px", borderRadius: 10, background: "linear-gradient(135deg,#25D366,#128C7E)", color: "#fff", fontSize: 13, fontWeight: 700, textDecoration: "none", fontFamily: "inherit" }}><Ico name="wa" color="#fff" size={14}/> ×©×œ×—×• ×”×•×“×¢×”</a>
            <button onClick={() => setShowIdle(false)} style={{ padding: "10px 16px", borderRadius: 10, border: "1.5px solid #E0E0DC", background: "#fff", color: "#666", fontSize: 12, fontWeight: 600, cursor: "pointer", fontFamily: "inherit" }}>×××©×™×š/×”</button>
          </div>
        </div>
      </div>}

      {/* Widget Card */}
      <div style={{ direction: "rtl", width: "100%", maxWidth: step === "branch" ? 540 : 460, background: "#FEFEFE", borderRadius: 20, overflow: "hidden", boxShadow: "0 4px 24px rgba(0,0,0,0.06)", transition: "max-width 0.3s", position: "relative", margin: "0 auto" }}>

        {/* Header */}
        <div style={{ background: headerBg, borderBottom: step !== "qual" ? `2px solid ${uc}` : "2px solid #1a1c29", padding: "24px 20px 20px", color: "#fff", position: "relative", transition: "background 0.4s ease,border-bottom 0.3s" }}>
          <div style={{ position: "absolute", inset: 0, opacity: 0.035, backgroundImage: "radial-gradient(circle,#fff 1px,transparent 1px)", backgroundSize: "22px 22px" }}/>
          <div style={{ position: "relative", zIndex: 1, display: "flex", alignItems: "center", gap: 16 }}>
            <div style={{ width: 64, height: 64, display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 }}>
              <img src="https://element-m-a-m.github.io/book-first-classes/Element%20Logo%20-%20Transparent%20Background.png" alt="Element Studio" style={{ maxWidth: "100%", maxHeight: "100%", objectFit: "contain", filter: "drop-shadow(0px 4px 6px rgba(0,0,0,0.4))" }}/>
            </div>
            <div style={{ flex: 1, minWidth: 0 }}>
              <div style={{ fontSize: 18, fontWeight: 800, marginBottom: 2 }}>{ht[0]}</div>
              {ht[1] && <div style={{ fontSize: "clamp(9.5px,2.5vw,11px)", opacity: 0.85, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" }}>{ht[1]}</div>}
            </div>
          </div>
          {step !== "qual" && <div style={{ display: "flex", gap: 4, marginTop: 18 }}>
            {Array.from({ length: totalSteps }).map((_,i) => <div key={i} style={{ height: 3, borderRadius: 2, flex: si >= i ? 2 : 1, background: si > i ? (isDone ? "#7DFFCC" : "#00E5A0") : si === i ? "#fff" : "rgba(255,255,255,0.2)", transition: "all 0.4s" }}/>)}
          </div>}
        </div>

        {/* Mini breadcrumb bar (steps 3-5 of group flow) */}
        {si > 1 && si < 5 && !isP && <div style={{ background: "#F8F7F4", padding: "10px 18px", fontSize: 11.5, color: "#555", display: "flex", justifyContent: "space-between", alignItems: "center", borderBottom: "1px solid #EEEEE9", fontWeight: 500 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 6 }}><Ico name="cart" color="#888" size={14}/><span>×”×–×× ×”: {cat?.label} {pkgObj ? `â€¢ ${pkgObj.label}` : ''}</span></div>
          {pkgObj && <span style={{ fontWeight: 800, color: uc, fontSize: 13 }}>â‚ª{currentPrice}</span>}
        </div>}

        {/* Scrollable body with step content */}
        <div className="widget-scroll" style={{ padding: "14px 18px 20px", height: "65vh", minHeight: 400, maxHeight: 550, overflowY: "auto", overflowX: "hidden", opacity: vis ? 1 : 0, transform: vis ? "translateX(0) scale(1)" : (animDir === "f" ? "translateX(-20px) scale(0.98)" : "translateX(20px) scale(0.98)"), transition: "opacity 0.2s cubic-bezier(0.2,0.8,0.2,1),transform 0.2s cubic-bezier(0.2,0.8,0.2,1)" }}>
          {stepMap[step]?.()}
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOUNT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const container = document.getElementById('element-booking-widget-container');
const root = ReactDOM.createRoot(container);
root.render(<ElementBookingWidget />);
</script>
</body>
</html>
